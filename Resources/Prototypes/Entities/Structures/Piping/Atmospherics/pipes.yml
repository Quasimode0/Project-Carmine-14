  - type: entity
    parent: BaseItem
    id: GasPipeBase
    name: pipe
    description: Holds gas.
    abstract: true
    placement:
      mode: SnapgridCenter
    components:
      - type: Sprite
        sprite: Structures/Piping/Atmospherics/pipe.rsi
        drawdepth: ThinPipe
        visible: false
      - type: StaticPrice
        price: 11

# Goobstation - Allow device-on-pipe stacking
      - type: Item
        size: Normal
      - type: Appearance
      - type: Tag
        tags: [Pipe]
      - type: Destructible
        thresholds:
          - trigger: !type:DamageTrigger
              damage: 200
            behaviors:
              - !type:DoActsBehavior
                acts: [Destruction]
          - trigger: !type:DamageTrigger
              damage: 100
            behaviors:
              - !type:PlaySoundBehavior
                sound:
                  collection: MetalBreak
                  params:
                    volume: -8
              - !type:SpawnEntitiesBehavior
                spawn:
                  GasPipeBroken:
                    min: 1
                    max: 1
                offset: 0
              - !type:DoActsBehavior
                acts: [Breakage]
      - type: Physics
        canCollide: false
        bodyType: static
      - type: Damageable
        damageContainer: Inorganic
        damageModifierSet: Metallic
      - type: Transform
        anchored: true
      - type: Visibility
        layer: 1
      - type: SubFloorHide
      - type: CollideOnAnchor
      - type: PipeAppearance
      - type: Anchorable
      - type: Rotatable
      - type: RCDDeconstructable
        cost: 1
        delay: 2
        fx: EffectRCDDeconstruct2
        rpd: true
      - type: PipeColorVisuals
      - type: NodeContainer
  # - type: PipeRestrictOverlap - Allow pipe stacking
      - type: AtmosUnsafeUnanchor
      - type: AtmosPipeColor
      - type: AtmosMonitoringConsoleDevice
  - type: entity
    parent: GasPipeBase
    id: GasPipeNoOverlap
    abstract: true
    components:
      - type: PipeRestrictOverlap

# Note: The PipeDirection of the PipeNode should be the south-facing version, because the entity starts at an angle of 0 (south)
  - type: entity
    parent: GasPipeNoOverlap
    id: GasPipeHalf
    suffix: Half
    components:
      - type: Sprite
        layers:
          - state: pipeHalf
            map: [enum.PipeVisualLayers.Pipe]
      - type: Construction
        graph: GasPipe
        node: half
      - type: NodeContainer
        nodes:
          pipe: !type:PipeNode
            nodeGroupID: Pipe
            pipeDirection: South
  - type: entity
    parent: GasPipeBase
    id: GasPipeStraight
    suffix: Straight
    components:
      - type: Sprite
        layers:
          - state: pipeStraight
            map: [enum.PipeVisualLayers.Pipe]
      - type: Item
        size: Normal
        storedSprite:
          sprite: Structures/Piping/Atmospherics/pipe.rsi
          state: storageStraight
        shape: ['0,0,0,2']
      - type: Construction
        graph: GasPipe
        node: straight
      - type: MeleeWeapon
        attackRate: 1
        damage:
          types:
            Blunt: 8
        soundHit:
          collection: MetalThud # this NEEDS to changed to the metal pipe falling sound effect on april first every year
      - type: NodeContainer
        nodes:
          pipe: !type:PipeNode
            nodeGroupID: Pipe
            pipeDirection: Longitudinal
  - type: entity
    parent: GasPipeNoOverlap
    id: GasPipeBend
    suffix: Bend
    components:
      - type: Sprite
        layers:
          - state: pipeBend
            map: [enum.PipeVisualLayers.Pipe]
      - type: Item
        size: Small
        shape: ['0,0,1,0', '1,1,1,1']
        heldPrefix: Bend
        storedSprite:
          sprite: Structures/Piping/Atmospherics/pipe.rsi
          state: storageBend
      - type: Construction
        graph: GasPipe
        node: bend
      - type: MeleeWeapon
        wideAnimationRotation: 180
        attackRate: 1
        damage:
          types:
            Blunt: 6
        soundHit:
          collection: MetalThud
      - type: DamageOtherOnHit
        damage:
          types:
            Blunt: 3 # This should be 6 but throwing damage is doubled at the moment for some reason so for now it's 3
      - type: NodeContainer
        nodes:
          pipe: !type:PipeNode
            nodeGroupID: Pipe
            pipeDirection: SWBend
  - type: entity
    parent: GasPipeNoOverlap
    id: GasPipeTJunction
    suffix: TJunction
    components:
      - type: Sprite
        layers:
          - state: pipeTJunction
            map: [enum.PipeVisualLayers.Pipe]
      - type: Item
        size: Normal
        shape: ['0,0,2,0', '1,1,1,1']
        heldPrefix: TJunction
        storedSprite:
          sprite: Structures/Piping/Atmospherics/pipe.rsi
          state: storageTJunction
      - type: Construction
        graph: GasPipe
        node: tjunction
      - type: MeleeWeapon
        wideAnimationRotation: 90
        attackRate: 0.75
        damage:
          types:
            Blunt: 10
        soundHit:
          collection: MetalThud
      - type: NodeContainer
        nodes:
          pipe: !type:PipeNode
            nodeGroupID: Pipe
            pipeDirection: TSouth
  - type: entity
    parent: GasPipeNoOverlap
    id: GasPipeFourway
    suffix: Fourway
    components:
      - type: Sprite
        layers:
          - state: pipeFourway
            map: [enum.PipeVisualLayers.Pipe]
      - type: Item
        size: Normal
        shape: ['1,0,1,2', '0,1,2,1']
        heldPrefix: Fourway
      - type: Transform
        noRot: true
      - type: Construction
        graph: GasPipe
        node: fourway
      - type: MeleeWeapon
        wideAnimationRotation: 90
        attackRate: 0.75
        damage:
          types:
            Blunt: 10
        soundHit:
          collection: MetalThud
      - type: NodeContainer
        nodes:
          pipe: !type:PipeNode
            nodeGroupID: Pipe
            pipeDirection: Fourway
  - type: entity
    parent: GasPipeNoOverlap
    id: GasPipeBroken
    name: broken pipe
    description: It used to hold gas.
    components:
      - type: Sprite
        sprite: Structures/Piping/Atmospherics/pipe.rsi
        drawdepth: ThinPipe
        state: pipeBroken
        layers:
          - state: pipeBroken
            map: [enum.PipeVisualLayers.Pipe]
      - type: Destructible
        thresholds: # override parent to avoid recursive destruction
          - trigger: !type:DamageTrigger
              damage: 100
            behaviors:
              - !type:DoActsBehavior
                acts: [Destruction]
      - type: Construction
        graph: GasPipe
        node: broken
